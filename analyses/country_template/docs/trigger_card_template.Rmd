---
title: "Document Title To Update"
pagetitle: 'AA Trigger Report'
output:
  html_notebook:
    css: style.css
    includes:
      in_header: header.html
    toc: yes
    toc_float: yes
    toc_depth: '4'
    df_print: paged
  html_document:
    css: style.css
    includes:
      in_header: header.html
    toc: yes
    toc_float: yes
    toc_depth: '4'
    df_print: paged
editor_options:
  chunk_output_type: console
---

```{r hard-coded values, message = FALSE, warning = FALSE}
country_name <- "Country Name"
shock <- "Shock"


```

```{r setup, include = FALSE, message = FALSE, warning = FALSE}
knitr::opts_chunk$set(echo = FALSE) # do not print code by default
knitr::opts_chunk$set(include = TRUE) # include chunk output by default
knitr::opts_chunk$set(message = FALSE) # do not print messages by default
knitr::opts_chunk$set(warning = TRUE) # do not print warnings by default

options(scipen = 999) # turn off scientific notation
options(encoding = "UTF-8") # set encoding to UTF-8 instead of ANSI
```

```{r libraries, include = FALSE}
packages <- c('tidyverse', 'ggthemes', 'kableExtra', 'knitr')

# install packages not yet installed
installed_packages <- packages %in% rownames(installed.packages())

if (any(installed_packages == FALSE)) {
  install.packages(packages[!installed_packages])
}

# load libraries 
lapply(packages, library, character.only = TRUE)

```

```{r functions}

```

```{r data loading}

```

<br> 
<br>
<br>

# Trigger Report
<br>
**Country:** `r country_name`
<br>
**Shock:** `r shock`
<br>
**Last updated:** `r Sys.Date()`

<br>

``` {r performance table}


```

```{r confidence intervals}
# load and shape data
ci_df <- data.frame(status = c('below_ci', 'ci', 'above_ci'),
# ci_df <- data.frame(status = c('low_end', 'estimate', 'high_end'),
           value = c(2, 3, 2),
           dummy = c(1, 1, 1)
           )
ci_df <- ci_df %>%
  mutate(status = factor(status, levels = c('below_ci', 'ci', 'above_ci')))

# compute width of segments
below_width <- ci_df %>%
   filter(status == 'below_ci') %>%
   select(value) %>%
   as.numeric()
          
ci_width <- ci_df %>%
   filter(status == 'ci') %>%
   select(value) %>%
   as.numeric()

# compute position of value labels (low end, central estimate, high end)
central.x <- ci_df %>% # estimate (midpoint of CI)
  filter(status == 'ci') %>%
  mutate(ci_midpoint = value / 2,
         x_position = below_width + ci_midpoint) %>%
  select(x_position) %>%
  as.numeric()

low.x <- ci_df %>% # position of CI's low end
  filter(status == 'below_ci') %>%
  select(value) %>%
  as.numeric()

high.x <- below_width + ci_width # position of CI's high end

# plot
ci_df %>%
  ggplot(aes(fill = status, y = value, x = dummy)) +
  geom_bar(position = "stack", stat = "identity", alpha = 0.9, width = 1) +
  scale_fill_manual(values = c("azure2", "#1bb580", "azure2")) +
  scale_x_continuous(limits = c(0, 5)) +
  #coord_cartesian(xlim=c(0, 2))
  coord_flip() +
  geom_segment(y = central.x, yend = central.x, x = 0.5, xend = 1.8, color = "#444444") + # central estimate label
  geom_segment(y = low.x, yend = low.x, x = 0.5, xend = 1.8, color = "#444444") + # low ci end label
  geom_segment(y = high.x, yend = high.x, x = 0.5, xend = 1.8, color = "#444444") + # high ci end label
  theme_economist_white(base_size = 11, 
                        base_family = "sans",
                        gray_bg = F, 
                        horizontal = F)
  # theme(
  #   legend.position = "none",
  #   plot.title = element_blank(),
  #   axis.line = element_blank(),
  #   axis.title = element_blank(),
  #   axis.ticks = element_blank(),
  #   axis.text = element_blank(),
  #   panel.grid.major = element_blank(),
  #   panel.grid.minor = element_blank()) +
  # scale_x_discrete(labels = NULL, breaks = NULL) + labs(x = "") 


```

